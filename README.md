# Nixlet

An experimental security-focused OS made primarily for embedded situations, based on NixOS. It is fully image-based and automatically handles OTA updates generated by CI.

The releases section contains some generic system profiles.

## Usage

Nixlet can be used as a library to generate your own image-based NixOS systems.

Here is an example `flake.nix` for a minimal system:

```nix
{
  description = "Example system image";
  inputs = {
    nixpkgs.url = github:NixOS/nixpkgs/nixos-unstable;
    nixlet = {
      url = github:peter-marshall5/nixlet;
      inputs.nixpkgs.follows = "nixpkgs";
    };
  };
  outputs = { self, nixpkgs, nixlet }: {
    packages.x86_64-linux.default = (nixpkgs.lib.nixosSystem {
      system = "x86_64-linux";
      modules = [
        nixlet.nixosModules.nixlet
        {
          system.image.id = "example";
          system.image.version = "0.1";
          ab-image.imageVariant.config.ab-image.updates.url = "https://github.com/owner/repo/releases/latest/download/";
          system.stateVersion = "23.11";
        }
      ];
    }).config.system.build.ab-image;
  };
}
```

## Disk layout

| Name     | Contents                     |
| -------- | ---------------------------- |
| ESP      | Bootloader and kernel images |
| Root A/B | Read-only system images      |
| Data     | User data                    |

The data partition is encrypted with LUKS. Support for secure boot and dm-verity is in progress.

## Notes

- NixOS unstable is required for now due to the use of bleeding-edge features in various systemd components. NixOS 24.05 will probably work once released.
